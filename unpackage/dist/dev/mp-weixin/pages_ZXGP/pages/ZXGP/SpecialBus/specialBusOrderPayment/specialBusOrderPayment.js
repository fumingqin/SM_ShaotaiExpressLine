(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment"],{466:
/*!*************************************************************************************************************************************************!*\
  !*** D:/UAD/NP_ComprehensiveTravel/main.js?{"page":"pages_ZXGP%2Fpages%2FZXGP%2FSpecialBus%2FspecialBusOrderPayment%2FspecialBusOrderPayment"} ***!
  \*************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";(function(e){n(/*! uni-pages */4);a(n(/*! vue */2));var t=a(n(/*! ./pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue */467));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createPage"])},467:
/*!************************************************************************************************************************!*\
  !*** D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue ***!
  \************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var a=n(/*! ./specialBusOrderPayment.vue?vue&type=template&id=4881c0c5& */468),o=n(/*! ./specialBusOrderPayment.vue?vue&type=script&lang=js& */470);for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n(/*! ./specialBusOrderPayment.vue?vue&type=style&index=0&lang=scss& */472);var s,i=n(/*! ../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */10),c=Object(i["default"])(o["default"],a["render"],a["staticRenderFns"],!1,null,null,null,!1,a["components"],s);c.options.__file="pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue",t["default"]=c.exports},468:
/*!*******************************************************************************************************************************************************!*\
  !*** D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=template&id=4881c0c5& ***!
  \*******************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,n){"use strict";n.r(t);var a=n(/*! -!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./specialBusOrderPayment.vue?vue&type=template&id=4881c0c5& */469);n.d(t,"render",(function(){return a["render"]})),n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),n.d(t,"components",(function(){return a["components"]}))},469:
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=template&id=4881c0c5& ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,n){"use strict";var a;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return s})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.turnDate(e.ticketInfo.date));e.$mp.data=Object.assign({},{$root:{m0:n}})},r=!1,s=[];o._withStripped=!0},470:
/*!*************************************************************************************************************************************************!*\
  !*** D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=script&lang=js& ***!
  \*************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var a=n(/*! -!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./specialBusOrderPayment.vue?vue&type=script&lang=js& */471),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},471:
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=script&lang=js& ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(/*! @/common/Ctky.js */43)),o=r(n(/*! @/pages_ZXGP/components/ZXGP/shoyu-date/utils.filter.js */431));function r(e){return e&&e.__esModule?e:{default:e}}var s={data:function(){return{countDownDate:120,utils:o.default,userInfo:[],hiddenValues:"0",channel:[{name:"微信"},{name:"支付宝"}],insurance:"",isInsurance:"",channeIndex:0,orderInfo:[],passengerInfo:[],idNameTypeStr:"",ticketNum:0,adultNum:0,freeTicketNum:0,childrenNum:0,adultTotalPrice:"",childrenTotalPrice:"",totalPrice:0,paymentData:[],timer:"",isPayEnable:!1,orderNum:"",ticketInfo:[],specialStartStation:"",specialEndStation:"",tickettype:"",ctkyOpenID:"",passengerNames:[],passengerIDs:[],weixinOpenId:""}},onLoad:function(t){var n=this;n.ticketInfo=JSON.parse(t.array),n.specialStartStation=n.ticketInfo.pickerStartStation,n.specialEndStation=n.ticketInfo.pickerEndStation,e.showLoading({title:"加载中..."}),this.getUserInfo(),this.getPassengerInfo()},onShow:function(){},onUnload:function(){clearInterval(this.timer)},onBackPress:function(e){var t=this;clearInterval(t.timer),"backbutton"==e.from&&(console.log("that.timer",t.timer),t.timer&&clearInterval(t.timer))},methods:{getUserInfo:function(){var t=this;e.getStorage({key:"userInfo",success:function(e){t.userInfo=e.data,t.weixinOpenId=e.data.openId_xcx}})},turnDate:function(e){if(e){var t=e.replace("T"," ");return t}},getPassengerInfo:function(){var t=this;e.getStorage({key:"passengerList",success:function(e){if(t.passengerInfo=e.data,t.passengerInfo.length>0)for(var n=0;n<t.passengerInfo.length;n++){"半票儿童"==e.data[n].userType?0:"成人"==e.data[n].userType?2:"免票儿童"==e.data[n].userType&&1,t.passengerNames.push(e.data[n].userName),t.passengerIDs.push(e.data[n].userCodeNum),t.ticketNum++,"半票儿童"==t.passengerInfo[n].userType?t.childrenNum++:"成人"==t.passengerInfo[n].userType?t.adultNum++:"免票儿童"==t.passengerInfo[n].userType&&t.freeTicketNum++}t.getOrder()},fail:function(){e.showToast({title:"获取信息失败",icon:"none"})}})},getOpenID:function(){var t=this;e.getStorage({key:"scenicSpotOpenId",success:function(e){t.ctkyOpenID=e.data,t.getOrder()},fail:function(e){t.ctkyOpenID=response.data,t.getOrder()}})},hide:function(e){this.hiddenValues=0==e?1:0},Selection:function(){0==this.channeIndex?this.channeIndex=1:this.channeIndex=0},screenUser:function(){var e=this.orderInfo.filter((function(e){return"成人"==e.userType})),t=this.orderInfo.filter((function(e){return"儿童"==e.userType}));this.adultIndex=e.length,this.childrenIndex=t.length,this.adultTotalPrice=e.length*this.orderInfo[0].ticketAdultPrice,this.childrenTotalPrice=t.length*this.orderInfo[0].ticketChildPrice},getOrder:function(){var t=this,n=(t.ticketInfo.date.replace("T"," "),"");n=a.default.KyInterface.systemName.systemNameWeiXin;var o=Number(t.childrenNum)+Number(t.freeTicketNum);console.log(n,t.ticketInfo.priceAID,t.userInfo.phoneNumber,t.adultNum,o,t.passengerIDs,t.passengerNames,t.userInfo.userId),e.request({url:a.default.KyInterface.Cs_BookingTicket.Url,method:a.default.KyInterface.Cs_BookingTicket.method,data:{sellerCompanyCode:n,priceAID:t.ticketInfo.priceAID,phoneNumber:t.userInfo.phoneNumber,fullTicket:t.adultNum,children:o,passengerIDs:t.passengerIDs,passengerNames:t.passengerNames,TPPID:"",UserAID:t.userInfo.userId},success:function(n){console.log("下单返回数据",n),n.data&&(1==n.data.Successed?(e.showToast({title:n.data.BookResult.Message,icon:"none"}),t.orderNum=n.data.BookResult.BookLogAID,t.getTicketPaymentInfo(n.data.BookResult.BookLogAID)):0==n.data.Successed&&(e.hideLoading(),e.showModal({content:n.data.msg,showCancel:!1,success:function(t){t.confirm&&e.navigateBack()}})))},fail:function(t){console.log("失败",t),e.hideLoading()}})},getTicketPaymentInfo:function(t){var n=this,o=a.default.KyInterface.payType.payType,r=null;n.timer=r,console.log(t);var s="";s=n.weixinOpenId,e.showLoading({title:"正在获取支付..."}),r=setInterval((function(){e.request({url:a.default.KyInterface.commonPayment.Url,method:a.default.KyInterface.commonPayment.method,data:{orderNumber:t,payType:o,openId:s,billDescript:"定制巴士订单服务费",goodsName:"定制巴士服务",price:n.ticketInfo.totalPrice},success:function(t){console.log(t.data),e.hideLoading(),1==t.data.status?(n.paymentData=t.data.data,clearInterval(r),e.showModal({content:"请尽快支付",success:function(e){e.confirm&&n.payment()}})):0==t.data.status&&clearInterval(r)},fail:function(t){e.hideLoading(),console.log("失败"),clearInterval(r)}})}),3e3)},payment:function(){var t=this;e.hideLoading(),e.requestPayment({timeStamp:t.paymentData.timeStamp,nonceStr:t.paymentData.nonceStr,package:t.paymentData.package,signType:t.paymentData.signType,paySign:t.paymentData.paySign,success:function(n){console.log(n),"requestPayment:ok"==n.errMsg?(e.showToast({title:"支付成功",icon:"none"}),e.showLoading({title:"加载中..."}),t.Cs_paySuccess(t.orderNum)):"requestPayment:fail cancel"==n.errMsg?setTimeout((function(){t.showToast("您取消了支付，请重新支付")}),1e3):"requestPayment:fail errors"==n.errMsg&&setTimeout((function(){t.showToast("支付失败，请重新支付")}),1e3)},fail:function(e){console.log(e),"requestPayment:fail cancel"==e.errMsg?setTimeout((function(){t.showToast("您取消了支付，请重新支付")}),1e3):"requestPayment:fail errors"==e.errMsg?setTimeout((function(){t.showToast("支付失败，请重新支付")}),1e3):t.showToast("支付出错")}})},showToast:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";e.showToast({title:t,icon:n})},Cs_paySuccess:function(t){e.showLoading({title:"正在检索，请稍后..."}),e.request({url:a.default.KyInterface.Cs_Confirm.Url,method:a.default.KyInterface.Cs_Confirm.method,header:a.default.KyInterface.Cs_Confirm.header,data:{bookID:t},success:function(t){console.log("支付成功后调接口",t),e.hideLoading(),1==t.data.BookResult.Successed&&e.redirectTo({url:"../../TraditionSpecial/PayMent/CTKYPaySuccess"})},fail:function(t){e.hideLoading(),console.log("支付失败后调接口",t)}})}}};t.default=s}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])},472:
/*!**********************************************************************************************************************************************************!*\
  !*** D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=style&index=0&lang=scss& ***!
  \**********************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){"use strict";n.r(t);var a=n(/*! -!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src??ref--8-oneOf-1-3!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../Software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./specialBusOrderPayment.vue?vue&type=style&index=0&lang=scss& */473),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},473:
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/UAD/NP_ComprehensiveTravel/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.vue?vue&type=style&index=0&lang=scss& ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,n){}},[[466,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../../../.sourcemap/mp-weixin/pages_ZXGP/pages/ZXGP/SpecialBus/specialBusOrderPayment/specialBusOrderPayment.js.map